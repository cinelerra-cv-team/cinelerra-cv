BUILDDATE=$(shell LC_ALL=C date)

if NEED_OPENEXR
    EXR_FILE_NAME=fileexr.C
endif

if BUILDINFO_RECOMPILE
BUILDINFO_NONRC_S=

main.o: versioninfo
aboutprefs.o: versioninfo

versioninfo:
else
BUILDINFO_NONRC_S=[unsure]

main.o: versioninfo.h
aboutprefs.o: versioninfo.h

versioninfo.h:
endif
	echo >versioninfo.h
	echo '#define CINELERRA_VERSION "$(VERSION)"' >> versioninfo.h
	echo >> versioninfo.h
	echo '#define BUILDDATE "$(BUILDDATE)"' >> versioninfo.h

if BUILDINFO_GIT
GITVERSION=$(shell if [ -d $(top_srcdir)/.git ]; then cd $(top_srcdir); git rev-parse HEAD; else echo "unknown"; fi)
	echo '#define REPOMAINTXT "GIT::$(GITVERSION) $(BUILDINFO_NONRC_S)"' >> versioninfo.h

else

if BUILDINFO_CUST

	echo '#define REPOMAINTXT      "$(BUILDINFO_CUSTOM_TAG)"' >> versioninfo.h

endif
endif
	echo '#define COPYRIGHTTEXT1 "(C) 2006 Heroine Virtual Ltd."' >> versioninfo.h
	echo '#define COPYRIGHTTEXT2 "(C) 2006-2024 The Cinelerra-CV Community"' >> versioninfo.h
	echo '#define COMPILEDATE "Compiled on $(BUILDDATE)"' >> versioninfo.h
	echo '#define FFMPEG_EXTERNALTEXT "@FFMPEG_EXTERNALTEXT@"' >> versioninfo.h

SUBDIRS = data

bin_PROGRAMS = cinelerracv

if HAVE_FIREWIRE
firewire_SOURCES = \
	audio1394.C \
	avc1394control.C \
	avc1394transport.C \
	device1394input.C \
	device1394output.C \
	iec61883input.C \
	iec61883output.C \
	vdevice1394.C
endif

cinelerracv_SOURCES = aattachmentpoint.C \
		    aautomation.C \
		    aboutprefs.C \
		    adeviceprefs.C \
		    aedit.C \
		    aedits.C \
		    affine.C \
		    amodule.C \
		    apatchgui.C \
		    apluginarray.C \
		    aplugin.C \
		    apluginset.C \
		    arender.C \
		    asset.C \
		    assetedit.C \
		    assetpopup.C \
		    assetremove.C \
		    assets.C \
		    atrack.C \
		    attachmentpoint.C \
		    audioalsa.C \
		    audiodevice.C \
		    audiodvb.C \
		    audioesound.C \
		    audioidevice.C \
		    audioodevice.C \
		    audiooss.C \
		    auto.C \
		    autoconf.C \
		    automation.C \
		    autos.C \
		    awindow.C \
		    awindowgui.C \
		    awindowmenu.C \
		    batch.C \
		    batchrender.C \
		    brender.C \
		    browsebutton.C \
		    cache.C \
		    cachebase.C \
		    canvas.C \
		    canvastools.C \
		    cicolors.C \
		    channel.C \
		    channeldb.C \
		    channeledit.C \
		    channelpicker.C \
		    chantables.C \
		    clipedit.C \
		    commonrender.C \
		    confirmsave.C \
		    cpanel.C \
		    cplayback.C \
		    ctimebar.C \
		    ctracking.C \
		    cwindow.C \
		    cwindowgui.C \
		    cwindowtool.C \
		    dcoffset.C \
		    deleteallindexes.C \
		    devicedvbinput.C \
		    drivesync.C \
		    dvbtune.C \
		    edit.C \
		    edithandles.C \
		    editpanel.C \
		    editpopup.C \
		    edits.C \
		    edl.C \
		    edlsession.C \
		    exportedl.C \
		    fadeengine.C \
		    fileac3.C \
		    filebase.C \
		    file.C \
		    filedv.C \
		    fileogg.C \
		    $(EXR_FILE_NAME) \
		    fileformat.C \
		    filejpeg.C \
		    filelist.C \
		    filemov.C \
		    filempeg.C \
		    filepng.C \
		    filesndfile.C \
		    filetga.C \
		    filethread.C \
		    filetiff.C \
		    filexml.C \
		    fileyuv.C \
		    floatauto.C \
		    floatautos.C \
		    formatcheck.C \
		    formatpresets.C \
		    formattools.C \
		    framecache.C \
		    garbage.C \
		    gwindow.C \
		    gwindowgui.C \
		    indexfile.C \
		    indexthread.C \
		    intauto.C \
		    intautos.C \
		    interfaceprefs.C \
		    keyframe.C \
		    keyframehandles.C \
		    keyframepopup.C \
		    keyframes.C \
		    labeledit.C \
		    labelnavigate.C \
		    labels.C \
		    levelwindow.C \
		    levelwindowgui.C \
		    loadbalance.C \
		    loadfile.C \
		    loadmode.C \
		    localsession.C \
		    main.C \
		    mainclock.C \
		    maincursor.C \
		    mainerror.C \
		    mainindexes.C \
		    mainmenu.C \
		    mainprogress.C \
		    mainsession.C \
		    mainundo.C \
		    manualgoto.C \
		    maskauto.C \
		    maskautos.C \
		    maskengine.C \
		    mbuttons.C \
		    menuaeffects.C \
		    menueffects.C \
		    menuveffects.C \
		    meterpanel.C \
		    module.C \
		    mtimebar.C \
		    mwindow.C \
		    mwindowedit.C \
		    mwindowgui.C \
		    mwindowmove.C \
		    new.C \
		    overlayframe.C \
		    packagedispatcher.C \
		    packagerenderer.C \
		    packagingengine.C \
		    panauto.C \
		    panautos.C \
		    patchbay.C \
		    patchgui.C \
		    performanceprefs.C \
		    picture.C \
                    pipe.C \
		    playabletracks.C \
		    playback3d.C \
		    playbackconfig.C \
		    playbackengine.C \
		    playbackprefs.C \
		    playtransport.C \
		    pluginaclient.C \
		    pluginaclientlad.C \
		    pluginarray.C \
		    pluginautos.C \
		    plugin.C \
		    pluginclient.C \
		    plugindialog.C \
		    pluginpopup.C \
		    pluginserver.C \
		    pluginset.C \
		    plugintclient.C \
		    plugintoggles.C \
		    pluginvclient.C \
		    pluginwindow.C \
		    preferences.C \
		    preferencesthread.C \
		    question.C \
		    quit.C \
		    recconfirmdelete.C \
		    recordableatracks.C \
		    recordablevtracks.C \
		    recordaudio.C \
		    record.C \
		    recordconfig.C \
		    recordgui.C \
		    recordlabel.C \
		    recordmonitor.C \
		    recordprefs.C \
		    recordthread.C \
		    recordtransport.C \
		    recordvideo.C \
		    recordwindow.C \
		    removethread.C \
		    render.C \
		    renderengine.C \
		    renderfarm.C \
		    renderfarmclient.C \
		    renderprofiles.C \
		    resample.C \
		    resizetrackthread.C \
		    resourcepixmap.C \
		    resourcethread.C \
		    samplescroll.C \
		    savefile.C \
		    selection.C \
		    setformat.C \
		    sharedlocation.C \
		    shmemory.C \
		    sighandler.C \
		    splashgui.C \
		    statusbar.C \
		    theme.C \
		    timebar.C \
		    timeentry.C \
		    tipwindow.C \
		    track.C \
		    trackcanvas.C \
		    tracking.C \
		    tracks.C \
		    trackscroll.C \
		    tracksedit.C \
		    transition.C \
		    transitionhandles.C \
		    transitionpopup.C \
		    transportque.C \
		    tunerserver.C \
		    undostackitem.C \
		    vattachmentpoint.C \
		    vautomation.C \
		    vdevicebase.C \
		    vdevicebuz.C \
		    vdevicedvb.C \
		    vdeviceprefs.C \
		    vdevicev4l.C \
		    vdevicev4l2.C \
		    vdevicev4l2jpeg.C \
		    vdevicex11.C \
		    vedit.C \
		    vedits.C \
		    videodevice.C \
		    viewmenu.C \
		    virtualaconsole.C \
		    virtualanode.C \
		    virtualconsole.C \
		    virtualnode.C \
		    virtualvconsole.C \
		    virtualvnode.C \
		    vmodule.C \
		    vpatchgui.C \
		    vplayback.C \
		    vpluginarray.C \
		    vplugin.C \
		    vpluginset.C \
		    vrender.C \
		    vtimebar.C \
		    vtrack.C \
		    vtracking.C \
		    vwindow.C \
		    vwindowgui.C \
		    wavecache.C \
                    yuvstream.C \
		    zoombar.C \
		    zoompanel.C \
	$(firewire_SOURCES)

# guicast must come first, to pick up correct workarounds.h
AM_CPPFLAGS = \
	-I$(top_srcdir)/guicast \
	-I$(top_srcdir)/quicktime \
	$(LIBMPEG3_CFLAGS)

AM_CXXFLAGS = \
	$(LARGEFILE_CFLAGS) \
	$(FIREWIRE_CFLAGS) \
	$(SOUND_CFLAGS) \
	$(XIPH_CFLAGS) \
	$(MJPEG_CFLAGS) \
	$(OPENEXR_CFLAGS) \
	$(LIBDV_CFLAGS) \
	$(FFMPEG_CFLAGS) \
	-DPLUGIN_DIR=\"$(plugindir)\" \
	-DLOCALE_DIR=\"$(localedir)\"

AM_LDFLAGS = -export-dynamic

noinst_HEADERS = aattachmentpoint.h \
		 aautomation.h \
		 aboutprefs.h \
		 adeviceprefs.h \
		 aedit.h \
		 aedits.h \
		 affine.h \
		 amodule.h \
		 apatchgui.h \
		 apluginarray.h \
		 aplugin.h \
		 apluginset.h \
		 arender.h \
		 asset.h \
		 assetedit.h \
		 assetpopup.h \
		 assetremove.h \
		 assets.h \
		 atrack.h \
		 attachmentpoint.h \
		 audio1394.h \
		 audioalsa.h \
		 audioconfig.h \
		 audiodevice.h \
		 audiodvb.h \
		 audioesound.h \
		 audiooss.h \
		 autoconf.h \
		 auto.h \
		 automation.h \
		 autos.h \
		 avc1394control.h \
		 avc1394transport.h \
		 awindowgui.h \
		 awindow.h \
		 awindowmenu.h \
		 batch.h \
		 batchrender.h \
		 binary.h \
		 brender.h \
		 browsebutton.h \
		 buz.h \
		 byteorder.h \
		 cache.h \
		 cachebase.h \
		 cameraauto.h \
		 canvas.h \
		 canvastools.h \
		 cicolors.h \
		 cinelerra.h \
		 channeledit.h \
		 channel.h \
		 channeldb.h \
		 channelpicker.h \
		 chantables.h \
		 clipedit.h \
		 commonrender.h \
		 compresspopup.h \
		 confirmsave.h \
		 cpanel.h \
		 cplayback.h \
		 ctimebar.h \
		 ctracking.h \
		 cwindowgui.h \
		 cwindow.h \
		 cwindowtool.h \
		 datatype.h \
		 dcoffset.h \
		 deleteallindexes.h \
		 device1394input.h \
		 device1394output.h \
		 devicedvbinput.h \
		 drivesync.h \
		 dv1394.h \
		 dvbtune.h \
		 edit.h \
		 edithandles.h \
		 editpanel.h \
		 editpopup.h \
		 edits.h \
		 edl.h \
		 edlsession.h \
		 exportedl.h \
		 fadeengine.h \
		 feather.h \
		 featheredits.h \
		 fileac3.h \
		 filebase.h \
		 fileformat.h \
		 file.h \
	    filedv.h \
	    fileogg.h \
		 fileexr.h \
		 filejpeg.h \
		 filelist.h \
		 filemov.h \
		 filempeg.h \
		 filepng.h \
		 filesndfile.h \
		 filetga.h \
		 filethread.h \
		 filetiff.h \
		 filexml.h \
		 fileyuv.h \
		 floatauto.h \
		 floatautos.h \
		 formatcheck.h \
		 formatpresets.h \
		 formattools.h \
		 framecache.h \
		 garbage.h \
		 gwindow.h \
		 gwindowgui.h \
		 iec61883input.h \
		 iec61883output.h \
		 ieee1394-ioctl.h \
		 indexfile.h \
		 indexthread.h \
		 intauto.h \
		 intautos.h \
		 interfaceprefs.h \
		 interlacemodes.h \
		 keyframe.h \
		 keyframehandles.h \
		 keyframepopup.h \
		 keyframes.h \
		 labeledit.h \
		 labelnavigate.h \
		 labels.h \
		 ladspa.h \
		 levelwindowgui.h \
		 levelwindow.h \
		 loadbalance.h \
		 loadfile.h \
		 loadmode.h \
		 localsession.h \
		 mainclock.h \
		 maincursor.h \
		 mainerror.h \
		 mainindexes.h \
		 mainmenu.h \
		 mainprogress.h \
		 mainsession.h \
		 mainundo.h \
		 manualgoto.h \
		 maskauto.h \
		 maskautos.h \
		 maskengine.h \
		 maxbuffers.h \
		 maxchannels.h \
		 mbuttons.h \
		 menuaeffects.h \
		 menueffects.h \
		 menuveffects.h \
		 messages.h \
		 meterpanel.h \
		 module.h \
		 mtimebar.h \
		 mwindowgui.h \
		 mwindow.h \
		 new.h \
		 newpresets.h \
		 ntsczones.h \
		 overlayframe.h \
		 packagedispatcher.h \
		 packagerenderer.h \
		 packagingengine.h \
		 panauto.h \
		 panautos.h \
		 patchbay.h \
		 patchgui.h \
		 patch.h \
		 performanceprefs.h \
		 picture.h \
                 pipe.h \
		 playabletracks.h \
		 playback3d.h \
		 playbackconfig.h \
		 playbackengine.h \
		 playbackprefs.h \
		 playtransport.h \
		 pluginaclient.h \
		 pluginaclientlad.h \
		 pluginarray.h \
		 pluginautos.h \
		 pluginclient.h \
		 plugincommands.h \
		 plugindialog.h \
		 plugin.h \
		 pluginpopup.h \
		 pluginprefs.h \
		 pluginserver.h \
		 pluginset.h \
		 plugintclient.h \
		 plugintoggles.h \
		 pluginvclient.h \
		 pluginwindow.h \
		 preferences.h \
		 preferencesthread.h \
		 question.h \
		 quit.h \
		 recconfirmdelete.h \
		 recordableatracks.h \
		 recordablevtracks.h \
		 recordaudio.h \
		 recordconfig.h \
		 recordengine.h \
		 recordgui.h \
		 record.h \
		 recordlabel.h \
		 recordmonitor.h \
		 recordprefs.h \
		 recordthread.h \
		 recordtransport.h \
		 recordvideo.h \
		 recordwindow.h \
		 removethread.h \
		 renderengine.h \
		 renderfarmclient.h \
		 renderfarm.h \
		 render.h \
		 resample.h \
		 renderprofiles.h \
		 resizetrackthread.h \
		 resourcepixmap.h \
		 resourcethread.h \
		 samplescroll.h \
		 savefile.h \
		 selection.h \
		 setformat.h \
		 sharedlocation.h \
		 shmemory.h \
		 sighandler.h \
		 splashgui.h \
		 statusbar.h \
		 theme.h \
		 timebar.h \
		 timeentry.h \
		 tipwindow.h \
		 trackcanvas.h \
		 track.h \
		 tracking.h \
		 trackscroll.h \
		 tracks.h \
		 transition.h \
		 transitionhandles.h \
		 transitionpopup.h \
		 transportque.h \
		 tunerserver.h \
		 undostackitem.h \
		 vattachmentpoint.h \
		 vautomation.h \
		 vdevice1394.h \
		 vdevicebase.h \
		 vdevicebuz.h \
		 vdevicedvb.h \
		 vdeviceprefs.h \
		 vdevicev4l.h \
		 vdevicev4l2.h \
		 vdevicev4l2jpeg.h \
		 vdevicex11.h \
		 vedit.h \
		 vedits.h \
		 video1394.h \
		 videodev.h \
		 videodevfix.h \
		 videodevice.h \
		 viewmenu.h \
		 virtualaconsole.h \
		 virtualanode.h \
		 virtualconsole.h \
		 virtualnode.h \
		 virtualvconsole.h \
		 virtualvnode.h \
		 vmodule.h \
		 vpatchgui.h \
		 vplayback.h \
		 vpluginarray.h \
		 vplugin.h \
		 vpluginset.h \
		 vrender.h \
		 vtimebar.h \
		 vtrack.h \
		 vtracking.h \
		 vwindowgui.h \
		 vwindow.h \
		 wavecache.h \
                 yuvstream.h \
		 zoombar.h \
		 zoompanel.h \
		$(srcdir)/*.inc
		 
cinelerracv_LDADD = \
	data/libimagedata.a \
	$(top_builddir)/mpeg2enc/libmpeg2enc.la \
	$(top_builddir)/toolame-02l/libtoolame.la \
	$(top_builddir)/quicktime/libquicktimecv.la \
	$(top_builddir)/guicast/libguicastcv.la \
	$(LIBMPEG3_LIBS) \
	@FFMPEG_LIBS@ \
	$(XIPH_LIBS) \
	$(A52DEC_LIBS) \
	$(OPENEXR_LIBS) \
	$(OPENGL_LIBS) \
	-lsndfile \
	-lmp3lame \
	-lpng -ljpeg -ltiff -lz \
	$(SOUND_LDFLAGS) \
	$(FIREWIRE_LDFLAGS) \
	$(LIBDV_LIBS) \
	-luuid \
	$(MJPEG_LIBS) \
	-lstdc++

EXTRA_DIST = gen-feather-h

clean-local:
	$(RM) versioninfo.h
